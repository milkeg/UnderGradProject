<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Lib_Synthese/WAVE.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>Lib_Synthese/WAVE.c</h1><a href="_w_a_v_e_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="_synthese___vocale_8h.html">Synthese_Vocale.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="_w_a_v_e_8h.html">WAVE.h</a>&quot;</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 
<a name="l00029"></a><a class="code" href="group__wave.html#ga8513fb8414c8c208b508e774826c790a">00029</a> <span class="keywordtype">void</span> <a class="code" href="group__wave.html#ga8513fb8414c8c208b508e774826c790a" title="module assurant l&amp;#39;écriture d&amp;#39;une structure WAVE et reconstitue à partir...">write_wavfile</a> (<a class="code" href="struct_w_a_v_e.html" title="Structure d&amp;#39;un fichier WAVE standart Structure codé grace aux structures RIFF...">WAVE</a> son, FILE *sortie) {
<a name="l00030"></a>00030 
<a name="l00031"></a>00031     fwrite(&amp;son.<a class="code" href="struct_w_a_v_e.html#a54f76f30b774f46c7504e59273f56c6a">RIFF</a>.<a class="code" href="struct_w_a_v_e_1_1_r_i_f_f.html#a29a7070135160538daab43ba406f1da0">ChunkID</a>, 4, 1, sortie);
<a name="l00032"></a>00032     fwrite(&amp;son.<a class="code" href="struct_w_a_v_e.html#a54f76f30b774f46c7504e59273f56c6a">RIFF</a>.<a class="code" href="struct_w_a_v_e_1_1_r_i_f_f.html#a18a01a40b7b53561b34a87246ad70b48">ChunkSize</a>, 4, 1, sortie);
<a name="l00033"></a>00033     fwrite(&amp;son.<a class="code" href="struct_w_a_v_e.html#a54f76f30b774f46c7504e59273f56c6a">RIFF</a>.<a class="code" href="struct_w_a_v_e_1_1_r_i_f_f.html#a2b40eb982d1f408ff2795bd1ffb57ea0">Format</a>, 4, 1, sortie);
<a name="l00034"></a>00034     fwrite(&amp;son.<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#ae9788b97dd09951f5017dd50727f4ffc">Subchunk1ID</a>, 4, 1, sortie);
<a name="l00035"></a>00035     fwrite(&amp;son.<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#a97d14bad22fbb11ebca974bdaca7e5e3">Subchunk1Size</a>, 4, 1, sortie);
<a name="l00036"></a>00036     fwrite(&amp;son.<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#aebdcaf3ae291173757c71927673d58b7">AudioFormat</a>, 2, 1, sortie);
<a name="l00037"></a>00037     fwrite(&amp;son.<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#ab598d3960b50035f99154c838ba13a77">NumChannels</a>, 2, 1, sortie);
<a name="l00038"></a>00038     fwrite(&amp;son.<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#ada1c16daae686bb0b9ad51be77eb7af7">SampleRate</a>, 4, 1, sortie);
<a name="l00039"></a>00039     fwrite(&amp;son.<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#a8250486e6791bb3e939aaebd933198be">ByteRate</a>, 4, 1, sortie);
<a name="l00040"></a>00040     fwrite(&amp;son.<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#a2dd56ef9b150a9b0e9b53fd98757a75e">Blockalign</a>, 2, 1, sortie);
<a name="l00041"></a>00041     fwrite(&amp;son.<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#a579fc25a33937da32724e8bf37a99bdd">BitsPerSample</a>, 2, 1, sortie);
<a name="l00042"></a>00042     fwrite(&amp;son.<a class="code" href="struct_w_a_v_e.html#a31d2ace2648f8bec29ba2a06cab24fa7">data</a>.<a class="code" href="struct_w_a_v_e_1_1data.html#a2914352727bbc343ac6d0b73acc066be">Subchunk2ID</a>, 4, 1, sortie);
<a name="l00043"></a>00043     fwrite(&amp;son.<a class="code" href="struct_w_a_v_e.html#a31d2ace2648f8bec29ba2a06cab24fa7">data</a>.<a class="code" href="struct_w_a_v_e_1_1data.html#a17e20c39122954437d62dbf956fabd5b">Subchunk2Size</a>, 4, 1, sortie);
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 
<a name="l00046"></a>00046     <span class="keywordtype">int</span> i=0;
<a name="l00047"></a>00047     <span class="keywordflow">for</span> (i=0; i&lt;son.<a class="code" href="struct_w_a_v_e.html#a31d2ace2648f8bec29ba2a06cab24fa7">data</a>.<a class="code" href="struct_w_a_v_e_1_1data.html#a17e20c39122954437d62dbf956fabd5b">Subchunk2Size</a>/son.<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#a2dd56ef9b150a9b0e9b53fd98757a75e">Blockalign</a>; i++) {
<a name="l00048"></a>00048         fwrite(&amp;son.<a class="code" href="struct_w_a_v_e.html#a31d2ace2648f8bec29ba2a06cab24fa7">data</a>.<a class="code" href="struct_w_a_v_e_1_1data.html#a5b5b032f747e9383fc0d98f7054e258f">data</a>[i], 2, 1, sortie);
<a name="l00049"></a>00049     }
<a name="l00050"></a>00050 }
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 
<a name="l00060"></a><a class="code" href="group__wave.html#gac6630711ba9f76ca9728d7e725cf68b9">00060</a> <span class="keywordtype">int</span> <a class="code" href="group__wave.html#gac6630711ba9f76ca9728d7e725cf68b9" title="module assurant la lecture d&amp;#39;un fichier son .wav et stocke toutes ses données...">Read_Wav</a> (<span class="keywordtype">char</span> *wave_file, <a class="code" href="struct_w_a_v_e.html" title="Structure d&amp;#39;un fichier WAVE standart Structure codé grace aux structures RIFF...">WAVE</a> *son) {
<a name="l00061"></a>00061         
<a name="l00062"></a>00062         <span class="comment">//création d&#39;un fichier</span>
<a name="l00063"></a>00063         FILE *file;
<a name="l00064"></a>00064         
<a name="l00065"></a>00065         <span class="comment">//ouverture/lecture du fichier wave_file en mode binaire (rb) : lecture en octets</span>
<a name="l00066"></a>00066         file = fopen(wave_file, <span class="stringliteral">&quot;rb&quot;</span>);
<a name="l00067"></a>00067 
<a name="l00068"></a>00068         <span class="comment">/* gestion d&#39;erreurs</span>
<a name="l00069"></a>00069 <span class="comment">         *</span>
<a name="l00070"></a>00070 <span class="comment">         * si l&#39;un des fichiers chargés est null, càd introuvable, on envoie une erreur et on arrête le programme.</span>
<a name="l00071"></a>00071 <span class="comment">         */</span>
<a name="l00072"></a>00072         <span class="keywordflow">if</span> (file == NULL) {
<a name="l00073"></a>00073                 printf(<span class="stringliteral">&quot;\nerreur: fichier  %s  introuvable\n&quot;</span>, wave_file);
<a name="l00074"></a>00074                 printf(<span class="stringliteral">&quot;\nsynthèse impossible&quot;</span>);
<a name="l00075"></a>00075                 exit(0);
<a name="l00076"></a>00076         }
<a name="l00077"></a>00077         
<a name="l00078"></a>00078         <span class="comment">/* lecture des données du fichier .wav et stockage de celle-ci dans les champs adéquats de la structure WAVE */</span>
<a name="l00079"></a>00079         fread(&amp;son-&gt;<a class="code" href="struct_w_a_v_e.html#a54f76f30b774f46c7504e59273f56c6a">RIFF</a>.<a class="code" href="struct_w_a_v_e_1_1_r_i_f_f.html#a29a7070135160538daab43ba406f1da0">ChunkID</a>, 4, 1, file);
<a name="l00080"></a>00080         fread(&amp;son-&gt;<a class="code" href="struct_w_a_v_e.html#a54f76f30b774f46c7504e59273f56c6a">RIFF</a>.<a class="code" href="struct_w_a_v_e_1_1_r_i_f_f.html#a18a01a40b7b53561b34a87246ad70b48">ChunkSize</a>, 4, 1, file);
<a name="l00081"></a>00081         fread(&amp;son-&gt;<a class="code" href="struct_w_a_v_e.html#a54f76f30b774f46c7504e59273f56c6a">RIFF</a>.<a class="code" href="struct_w_a_v_e_1_1_r_i_f_f.html#a2b40eb982d1f408ff2795bd1ffb57ea0">Format</a>, 4, 1, file);
<a name="l00082"></a>00082         fread(&amp;son-&gt;<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#ae9788b97dd09951f5017dd50727f4ffc">Subchunk1ID</a>, 4, 1, file);
<a name="l00083"></a>00083         fread(&amp;son-&gt;<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#a97d14bad22fbb11ebca974bdaca7e5e3">Subchunk1Size</a>, 4, 1, file);
<a name="l00084"></a>00084         fread(&amp;son-&gt;<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#aebdcaf3ae291173757c71927673d58b7">AudioFormat</a>, 2, 1, file);
<a name="l00085"></a>00085         fread(&amp;son-&gt;<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#ab598d3960b50035f99154c838ba13a77">NumChannels</a>, 2, 1, file);
<a name="l00086"></a>00086         fread(&amp;son-&gt;<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#ada1c16daae686bb0b9ad51be77eb7af7">SampleRate</a>, 4, 1, file);
<a name="l00087"></a>00087         fread(&amp;son-&gt;<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#a8250486e6791bb3e939aaebd933198be">ByteRate</a>, 4, 1, file);
<a name="l00088"></a>00088         fread(&amp;son-&gt;<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#a2dd56ef9b150a9b0e9b53fd98757a75e">Blockalign</a>, 2, 1, file);
<a name="l00089"></a>00089         fread(&amp;son-&gt;<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#a579fc25a33937da32724e8bf37a99bdd">BitsPerSample</a>, 2, 1, file);
<a name="l00090"></a>00090         fread(&amp;son-&gt;<a class="code" href="struct_w_a_v_e.html#a31d2ace2648f8bec29ba2a06cab24fa7">data</a>.<a class="code" href="struct_w_a_v_e_1_1data.html#a2914352727bbc343ac6d0b73acc066be">Subchunk2ID</a>, 4, 1, file);
<a name="l00091"></a>00091         fread(&amp;son-&gt;<a class="code" href="struct_w_a_v_e.html#a31d2ace2648f8bec29ba2a06cab24fa7">data</a>.<a class="code" href="struct_w_a_v_e_1_1data.html#a17e20c39122954437d62dbf956fabd5b">Subchunk2Size</a>, 4, 1, file);
<a name="l00092"></a>00092         
<a name="l00093"></a>00093         <span class="comment">/* allocation de la taille du tableau data[] contenant les échantillons de la structure WAVE</span>
<a name="l00094"></a>00094 <span class="comment">         *</span>
<a name="l00095"></a>00095 <span class="comment">         * Blockalign: nombre d&#39;octects pour coder un sample</span>
<a name="l00096"></a>00096 <span class="comment">         * Subchunk2Size: nombre d&#39;octects que représente tous les échantillons.</span>
<a name="l00097"></a>00097 <span class="comment">         * on a donc le nombre d&#39;échantillons en faisant l&#39;opération Subchunk2Size/Blockalign</span>
<a name="l00098"></a>00098 <span class="comment">         * un échantillon est contenable dans un short donc chaque case doit être de la taille d&#39;un short.</span>
<a name="l00099"></a>00099 <span class="comment">         */</span>
<a name="l00100"></a>00100         son-&gt;<a class="code" href="struct_w_a_v_e.html#a31d2ace2648f8bec29ba2a06cab24fa7">data</a>.<a class="code" href="struct_w_a_v_e_1_1data.html#a5b5b032f747e9383fc0d98f7054e258f">data</a> = malloc( (<span class="keywordtype">int</span>)(son-&gt;<a class="code" href="struct_w_a_v_e.html#a31d2ace2648f8bec29ba2a06cab24fa7">data</a>.<a class="code" href="struct_w_a_v_e_1_1data.html#a17e20c39122954437d62dbf956fabd5b">Subchunk2Size</a> + 1) / (<span class="keywordtype">int</span>)son-&gt;<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#a2dd56ef9b150a9b0e9b53fd98757a75e">Blockalign</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>) );
<a name="l00101"></a>00101         
<a name="l00102"></a>00102         <span class="keywordtype">int</span> i;
<a name="l00103"></a>00103         
<a name="l00104"></a>00104         <span class="comment">//remplissage du tableau d&#39;échantillons data[] de la structure WAVE</span>
<a name="l00105"></a>00105         <span class="keywordflow">for</span> (i=0; i &lt; (int)son-&gt;<a class="code" href="struct_w_a_v_e.html#a31d2ace2648f8bec29ba2a06cab24fa7">data</a>.<a class="code" href="struct_w_a_v_e_1_1data.html#a17e20c39122954437d62dbf956fabd5b">Subchunk2Size</a>/son-&gt;<a class="code" href="struct_w_a_v_e.html#a63a69b0767fd94b2295fd25c726a44c8">fmt</a>.<a class="code" href="struct_w_a_v_e_1_1fmt.html#a2dd56ef9b150a9b0e9b53fd98757a75e">Blockalign</a>; i++){
<a name="l00106"></a>00106                 fread(&amp;son-&gt;<a class="code" href="struct_w_a_v_e.html#a31d2ace2648f8bec29ba2a06cab24fa7">data</a>.<a class="code" href="struct_w_a_v_e_1_1data.html#a5b5b032f747e9383fc0d98f7054e258f">data</a>[i], 2, 1, file);
<a name="l00107"></a>00107         }
<a name="l00108"></a>00108         
<a name="l00109"></a>00109         <span class="comment">//fermeture du fichier</span>
<a name="l00110"></a>00110         fclose(file);
<a name="l00111"></a>00111         
<a name="l00112"></a>00112         <span class="keywordflow">return</span> 0;
<a name="l00113"></a>00113 }
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri May 7 15:55:12 2010 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
