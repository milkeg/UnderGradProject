<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Lib_Synthese/Traitement_Chaine.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>Lib_Synthese/Traitement_Chaine.c</h1><a href="_traitement___chaine_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00006"></a>00006 <span class="preprocessor">#include&lt;stdio.h&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include&lt;stdlib.h&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include&lt;string.h&gt;</span>
<a name="l00009"></a>00009 
<a name="l00031"></a><a class="code" href="group__traitement.html#ga9e88fc0773d99f882aae1110c9c72a22">00031</a> <span class="keywordtype">void</span> <a class="code" href="group__traitement.html#ga9e88fc0773d99f882aae1110c9c72a22" title="Traitement de la chaine.">traitement_chaine</a>(<span class="keywordtype">char</span> *chaine,<span class="keywordtype">char</span> **t,<span class="keywordtype">int</span> *nbe, <span class="keywordtype">int</span> *error) {
<a name="l00032"></a>00032         <span class="keywordtype">char</span> ptr[256],ptr1[256];
<a name="l00033"></a>00033         <span class="keywordtype">int</span> i,longueur_chaine,longueur_souschaine,k,j,reste;
<a name="l00034"></a>00034         <span class="keywordtype">int</span> err = 0;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036         <span class="comment">/* On récupère la longueur de la chaine */</span>
<a name="l00037"></a>00037         longueur_chaine=strlen(chaine);
<a name="l00038"></a>00038 
<a name="l00039"></a>00039         <span class="comment">/*</span>
<a name="l00040"></a>00040 <span class="comment">         * On initialise i et j à 0 pour parcourir les différentes chaine.</span>
<a name="l00041"></a>00041 <span class="comment">         * i pour la chaine principale et j pour la chaine secondaire (sous-chaine).</span>
<a name="l00042"></a>00042 <span class="comment">         */</span>
<a name="l00043"></a>00043         j=0;i=0;
<a name="l00044"></a>00044 
<a name="l00045"></a>00045         <span class="comment">/* On initialise k à 0 pour parcourir le tableau de chaine qui contiendra les différentes sous-chaines qui proviennent</span>
<a name="l00046"></a>00046 <span class="comment">         * de la segmentation de la chaine principale.</span>
<a name="l00047"></a>00047 <span class="comment">         */</span>
<a name="l00048"></a>00048         k=0;
<a name="l00049"></a>00049 
<a name="l00050"></a>00050         <span class="comment">/* Boucle principale.</span>
<a name="l00051"></a>00051 <span class="comment">         * On parcourt la chaine tant que le compteur i est strictement inférieur à la longueur de la chaine.</span>
<a name="l00052"></a>00052 <span class="comment">         * A chaque tour de boucle, les caractères de la chaine sont analysés.</span>
<a name="l00053"></a>00053 <span class="comment">         */</span>
<a name="l00054"></a>00054         <span class="keywordflow">while</span>(i&lt;longueur_chaine){
<a name="l00055"></a>00055 
<a name="l00056"></a>00056                 <span class="comment">/* Lorsque le caractère rencontré est un &#39;+&#39;, on le stoke dans la chaine secondaire.</span>
<a name="l00057"></a>00057 <span class="comment">                 * Cette condition est vérifiée seulement lorsque l&#39;on rencontre un &#39;+&#39; en début de chaine et que la lampe est éteinte</span>
<a name="l00058"></a>00058 <span class="comment">                 * Ensuite, on incrémente la valeur de j pour completer la chaine ultérieurement.</span>
<a name="l00059"></a>00059 <span class="comment">                 * La lampe prend la valeur TRUE.</span>
<a name="l00060"></a>00060 <span class="comment">                 * Le but est donc de prendre en compte le &#39;+&#39; en début de chaine seulement une seule fois, ce qui est fait en utilisant la lampe.</span>
<a name="l00061"></a>00061 <span class="comment">                 */</span>
<a name="l00062"></a>00062                 <span class="keywordflow">if</span> ((chaine[i]==<span class="charliteral">&#39;+&#39;</span>) &amp;&amp; (i==0)){
<a name="l00063"></a>00063                         ptr[0]=chaine[i];  <span class="comment">/* Le &#39;+&#39; est stocké dans ptr la chaine secondaire (uniquement en début). */</span>
<a name="l00064"></a>00064                         j++;
<a name="l00065"></a>00065                 }
<a name="l00066"></a>00066                 <span class="comment">/* Si la condition précédente n&#39;est pas vérifiée, on traite les caractères entre &#39;0&#39; et &#39;9&#39; (chiffres) et les caractères de séparation.</span>
<a name="l00067"></a>00067 <span class="comment">                 * Les caractères entre &#39;0&#39; et &#39;9&#39; seront stockés dans la chaine secondaire.</span>
<a name="l00068"></a>00068 <span class="comment">                 */</span>
<a name="l00069"></a>00069                 <span class="keywordflow">else</span>
<a name="l00070"></a>00070                 {
<a name="l00071"></a>00071                         <span class="comment">/* Boucle secondaire</span>
<a name="l00072"></a>00072 <span class="comment">                         * Tant que l&#39;on ne recontre pas un caractère de séparation ou que l&#39;on a pas atteint la fin de chaine,</span>
<a name="l00073"></a>00073 <span class="comment">                         * on parcourt la chaine à partir de i, position du caractère courant.</span>
<a name="l00074"></a>00074 <span class="comment">                         * Le fait de rencontrer ces caractères de séparation signifie que l&#39;on a une sous-chaine formée et qui a été stockée dans ptr.</span>
<a name="l00075"></a>00075 <span class="comment">                         * Les &#39;+&#39; ne ne sont pas pris en compte.</span>
<a name="l00076"></a>00076 <span class="comment">                         */</span>
<a name="l00077"></a>00077                         <span class="keywordflow">while</span> ((chaine[i]!=<span class="charliteral">&#39; &#39;</span>) &amp;&amp; (chaine[i]!=<span class="charliteral">&#39;,&#39;</span>) &amp;&amp; (chaine[i]!=<span class="charliteral">&#39;.&#39;</span>) &amp;&amp; (chaine[i]!=<span class="charliteral">&#39;-&#39;</span>)&amp;&amp;(i&lt;longueur_chaine)) {
<a name="l00078"></a>00078 
<a name="l00079"></a>00079                                 <span class="comment">//printf(&quot;/t%d\n&quot;, i);</span>
<a name="l00080"></a>00080                                 <span class="keywordflow">if</span> ((chaine[i]&gt;=<span class="charliteral">&#39;0&#39;</span>)&amp;&amp;(chaine[i]&lt;=<span class="charliteral">&#39;9&#39;</span>)) { <span class="comment">/* Seulement les caractères entre &#39;0&#39; et &#39;9&#39; sont traités. */</span>
<a name="l00081"></a>00081                                         ptr[j]=chaine[i]; <span class="comment">/* La sous-chaine est formée. */</span>
<a name="l00082"></a>00082                                         j++; <span class="comment">/* On incrémente j pour completer la chaine ptr. */</span>
<a name="l00083"></a>00083                                 } <span class="keywordflow">else</span> {
<a name="l00084"></a>00084                                         <span class="comment">/* le caractère n&#39;est pas compris entre &#39;0&#39; et &#39;9&#39; =&gt; carractère non reconnu</span>
<a name="l00085"></a>00085 <span class="comment">                                         * si le caractère n&#39;est pas &#39;\n&#39; càd désignant la fin de la chaine (acceptable)</span>
<a name="l00086"></a>00086 <span class="comment">                                         *     alors incrémentation de err</span>
<a name="l00087"></a>00087 <span class="comment">                                         */</span>
<a name="l00088"></a>00088                                         <span class="keywordflow">if</span>(chaine[i] != <span class="charliteral">&#39;\n&#39;</span>) {
<a name="l00089"></a>00089                                                 err++;
<a name="l00090"></a>00090                                         }
<a name="l00091"></a>00091                                 }
<a name="l00092"></a>00092                                 <span class="comment">/*</span>
<a name="l00093"></a>00093 <span class="comment">                                 * On incrémente i jusqu&#39;a ce que l&#39;on rencontre un caractère de séparation ou jusqu&#39;a la fin de la chaine.</span>
<a name="l00094"></a>00094 <span class="comment">                                 * On aura ainsi une sous-chaine extraite.</span>
<a name="l00095"></a>00095 <span class="comment">                                 */</span>
<a name="l00096"></a>00096                                 i++;
<a name="l00097"></a>00097                         }
<a name="l00098"></a>00098                 }
<a name="l00099"></a>00099 
<a name="l00100"></a>00100                 ptr[j]=<span class="charliteral">&#39;\0&#39;</span>; <span class="comment">/* On complete la sous-chaine par un &#39;\0&#39; pour indiquer la fin de sous-chaine. */</span>
<a name="l00101"></a>00101 
<a name="l00102"></a>00102                 <span class="comment">/* ptr est donc une chaine de caractère qui a été extraite de la chaine principale</span>
<a name="l00103"></a>00103 <span class="comment">                 * Notons ici que la sous-chaine peut soit etre composé d&#39;un &#39;+&#39; ou d&#39;une suite de caractère entre &#39;0&#39; et &#39;9&#39;.</span>
<a name="l00104"></a>00104 <span class="comment">                 */</span>
<a name="l00105"></a>00105                 <span class="keywordflow">if</span> (strcmp(ptr,<span class="stringliteral">&quot;&quot;</span>)!=0){ <span class="comment">/*On commence le traitement de la sous-chaine si elle n&#39;est pas vide. */</span>
<a name="l00106"></a>00106 
<a name="l00107"></a>00107                         longueur_souschaine=strlen(ptr); <span class="comment">/*  on recupère la longueur de la sous-chaine extraite de la chaine principale. */</span>
<a name="l00108"></a>00108 
<a name="l00109"></a>00109                         <span class="comment">/* Selon la longueur de la sous-chaine, on va effectuer deux traitements différents sur la sous-chaine.</span>
<a name="l00110"></a>00110 <span class="comment">                         * Dans le cas ou cette longueur est supérieure à quatres caractères, la sous-chaine va être segmentée par paire.</span>
<a name="l00111"></a>00111 <span class="comment">                         * On fera intervenir une deuxieme variable qui prendra pour valeur un segment de la chaine principale.</span>
<a name="l00112"></a>00112 <span class="comment">                         * Chaque paire de caractères sera ensuite copiée dans le tableau de chaines.</span>
<a name="l00113"></a>00113 <span class="comment">                         */</span>
<a name="l00114"></a>00114                         <span class="keywordflow">if</span> (longueur_souschaine&gt;4){
<a name="l00115"></a>00115 
<a name="l00116"></a>00116                         <span class="comment">/* Selon la parité de la longueur de la chaine, il y aura deux cas.</span>
<a name="l00117"></a>00117 <span class="comment">                         * Si la longueur est impaire, le premier caractère de cette sous-chaine est isolé. On fait appel à une nouvelle variable: ptr1.</span>
<a name="l00118"></a>00118 <span class="comment">                         * On copie ce caractère dans la chaine temporaire qui est copié à son tour dans le tableau de chaines.</span>
<a name="l00119"></a>00119 <span class="comment">                         * Enfin, puisque la longueur de chaine est impaire, le reste de la division est à 1. Cette valeur est stockée dans l1.</span>
<a name="l00120"></a>00120 <span class="comment">                         * l1 qui sera utilisé pour traiter les segments suivants de la sous-chaine.</span>
<a name="l00121"></a>00121 <span class="comment">                         */</span>
<a name="l00122"></a>00122                                 <span class="keywordflow">if</span> ((longueur_souschaine%2)!=0){ <span class="comment">/* La longueur de la chaine est impaire. */</span>
<a name="l00123"></a>00123                                 ptr1[0]=ptr[0];   <span class="comment">/* On copie le premier caractère de la sous-chaine (on l&#39;isole). */</span>
<a name="l00124"></a>00124                                 ptr1[1]=<span class="charliteral">&#39;\0&#39;</span>;    <span class="comment">/* On complete la sous-chaine par un &#39;\0&#39; pour indiquer la fin de chaine. */</span>
<a name="l00125"></a>00125                                 t[k] = (<span class="keywordtype">char</span>*) malloc( 5*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
<a name="l00126"></a>00126                                 strcpy(t[k],ptr1);
<a name="l00127"></a>00127                                 k++;
<a name="l00128"></a>00128                                 reste=1;  <span class="comment">/* La chaine est impaire. Le reste est à 1. */</span>
<a name="l00129"></a>00129                         }
<a name="l00130"></a>00130                                 <span class="keywordflow">else</span> <span class="comment">/* La longueur de la chaine est paire */</span>
<a name="l00131"></a>00131                                 {
<a name="l00132"></a>00132                                         reste=0; <span class="comment">/* Le reste est à 0. */</span>
<a name="l00133"></a>00133                                 }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135                         <span class="comment">/* Tant que le reste est strictement inférieur à la longueur de la chaine, on parcourt la sous-chaine.</span>
<a name="l00136"></a>00136 <span class="comment">                         * On continue de segmenter la sous-chaine. Le reste est soit à 0 ou 1.</span>
<a name="l00137"></a>00137 <span class="comment">                         * On utilisera cette valeur comme indice à partir duquel il faut parcourir et segmenter la sous-chaine.</span>
<a name="l00138"></a>00138 <span class="comment">                         * Lorsque deux caractères ont été copié dans la chaine temporaire, on stoke cette chaine temporaire (ptr1) dans le tableau de chaine.</span>
<a name="l00139"></a>00139 <span class="comment">                         * Enfin on ajoute 2 à l1, puisqu&#39;on a copié deux caractères.</span>
<a name="l00140"></a>00140 <span class="comment">                         */</span>
<a name="l00141"></a>00141                                 <span class="keywordflow">while</span> (reste&lt;longueur_souschaine){
<a name="l00142"></a>00142                                         ptr1[0]=ptr[reste]; <span class="comment">/* On copie deux caractères dans la chaine ptr1 */</span>
<a name="l00143"></a>00143                                         ptr1[1]=ptr[reste+1];
<a name="l00144"></a>00144                                         ptr1[2]=<span class="charliteral">&#39;\0&#39;</span>;  <span class="comment">/* On complete la sous-chaine par un &#39;\0&#39; pour indiquer la fin de chaine. */</span>
<a name="l00145"></a>00145                                         t[k] = (<span class="keywordtype">char</span>*) malloc( 5*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
<a name="l00146"></a>00146                                         strcpy(t[k],ptr1);   <span class="comment">/* On copie la chaine temporaire dans le tableau de chaines de caractères */</span>
<a name="l00147"></a>00147                                         k++;
<a name="l00148"></a>00148                                         reste=reste+2;
<a name="l00149"></a>00149                                 }
<a name="l00150"></a>00150                         }
<a name="l00151"></a>00151 
<a name="l00152"></a>00152                         <span class="comment">/* Sinon, quand la longueur de la sous-chaine est inférieur à 4, on stoke directement cette chaine dans le tableau de chaines. */</span>
<a name="l00153"></a>00153                         <span class="keywordflow">else</span>
<a name="l00154"></a>00154                         {
<a name="l00155"></a>00155                         t[k] = (<span class="keywordtype">char</span>*) malloc( 5*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
<a name="l00156"></a>00156                         strcpy(t[k],ptr);   
<a name="l00157"></a>00157                         k++;   <span class="comment">/* On incrémente k pour compléter ultérieurement le tableau de chaines.  */</span>
<a name="l00158"></a>00158                     }
<a name="l00159"></a>00159                     strcpy(ptr,<span class="stringliteral">&quot;       &quot;</span>); <span class="comment">/* On supprime le contenu de la sous-chaine pour pouvoir traiter la sous-chaine suivante, lorsque i sera incrémenté. */</span>
<a name="l00160"></a>00160                 }
<a name="l00161"></a>00161                 j=0; <span class="comment">/* On remet l&#39;indice de la sous-chaine à 0 pour pouvoir y stocker la prochaine sous-chaine.*/</span>
<a name="l00162"></a>00162                 i++; <span class="comment">/* On incrémente i pour passer au caractère suivant de la chaine principale. */</span>
<a name="l00163"></a>00163         }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165         <span class="comment">/* gestion d&#39;erreur:</span>
<a name="l00166"></a>00166 <span class="comment">         *</span>
<a name="l00167"></a>00167 <span class="comment">         * si la première case du tableau est vide, cela implique qu&#39;aucun des caractères de chaine[] n&#39;est reconnu</span>
<a name="l00168"></a>00168 <span class="comment">         * on a donc une erreur d&#39;entrée (numero non valide)</span>
<a name="l00169"></a>00169 <span class="comment">         * On arrête le programme</span>
<a name="l00170"></a>00170 <span class="comment">         */</span>
<a name="l00171"></a>00171         <span class="keywordflow">if</span> (k == 0) {
<a name="l00172"></a>00172                 printf(<span class="stringliteral">&quot;\nerreur: aucun caractère reconnu\n&quot;</span>);
<a name="l00173"></a>00173                 printf(<span class="stringliteral">&quot;\nsynthèse impossible&quot;</span>);
<a name="l00174"></a>00174                 exit(0);
<a name="l00175"></a>00175         }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177         <span class="comment">/* gestion d&#39;avertissement:</span>
<a name="l00178"></a>00178 <span class="comment">         *</span>
<a name="l00179"></a>00179 <span class="comment">         * si err est supérieur à 0, (càd qu&#39;il a été incrémenté au moins une fois =&gt; au moins un caractère non reconnu)</span>
<a name="l00180"></a>00180 <span class="comment">         * alors on incrémente la variable error</span>
<a name="l00181"></a>00181 <span class="comment">         * cela impliquera que (error%10) ne soit pas nul ce qui permettra un printf ultérieur de l&#39;avertissement:</span>
<a name="l00182"></a>00182 <span class="comment">         * &quot;certains caractères entrées ne sont pas reconnus, ils ont étés supprimés&quot;</span>
<a name="l00183"></a>00183 <span class="comment">         */</span>
<a name="l00184"></a>00184         <span class="keywordflow">if</span> ( err &gt; 0 ) {
<a name="l00185"></a>00185                 *error += 1;
<a name="l00186"></a>00186         }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188         *nbe=k; <span class="comment">/*taille du tableau de chaine, à utiliser après traitement_chaine */</span>
<a name="l00189"></a>00189 }
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri May 7 15:55:12 2010 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
